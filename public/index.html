<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

<title>Watcher Player</title>

<script src="https://telegram.org/js/telegram-web-app.js?59"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{
  width:100%;
  height:100%;
  background:#f2f3f5;
  font-family:system-ui,-apple-system,Segoe UI,sans-serif;
}

/* ---------- SCREENS ---------- */
.screen{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
}
.screen.active{display:flex}

/* ---------- INTRO ---------- */
#intro{
  background:#f2f3f5;
  flex-direction:column;
  gap:18px;
}
#intro h2{
  font-size:18px;
}
#intro button{
  padding:12px 22px;
  border:none;
  border-radius:10px;
  background:#000;
  color:#fff;
  font-size:15px;
}

/* ---------- PLAYER ---------- */
#player{
  background:#000;
}
#videoBox{
  position:relative;
  width:100%;
  max-width:420px;
  aspect-ratio:9/16;
  background:#000;
  border-radius:14px;
  overflow:hidden;
}
.fullscreen #videoBox{
  width:100vw;
  height:100vh;
  max-width:none;
  aspect-ratio:auto;
  border-radius:0;
}

/* iframe */
#videoFrame{
  width:100%;
  height:100%;
  border:none;
  background:#000;
  transform-origin:center;
}
.normal #videoFrame{transform:scale(1.02)}
.fullscreen #videoFrame{transform:rotate(90deg) scale(1.65)}

/* ---------- LOADING ---------- */
#loading{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  font-size:15px;
  background:#000;
  z-index:10;
}

/* ---------- CONTROLS ---------- */
.btn{
  position:fixed;
  padding:7px 14px;
  border:none;
  border-radius:999px;
  background:rgba(0,0,0,.7);
  color:#fff;
  font-size:14px;
  font-weight:600;
  z-index:10000;
}
#btnClose{top:64px;left:16px}
#btnMode{right:16px;top:50%;transform:translateY(-50%)}
</style>
</head>

<body>

<!-- INTRO / TITLE SCREEN -->
<div id="intro" class="screen active">
  <h2>Ready to watch?</h2>
  <button onclick="startPlayer()">▶ Watch Video</button>
</div>

<!-- PLAYER -->
<div id="player" class="screen normal">
  <div id="videoBox">
    <div id="loading">Loading video…</div>
    <iframe id="videoFrame" allow="autoplay; fullscreen"></iframe>
  </div>

  <button id="btnClose" class="btn" onclick="closeApp()">✕ Close</button>
  <button id="btnMode" class="btn" onclick="toggleFS()">⛶ Fullscreen</button>
</div>

<script>
const tg = Telegram.WebApp;
tg.ready();
tg.expand();

/* ---------- URL FIX ---------- */
const params = new URLSearchParams(location.search);
const rawUrl = params.get("url");

/* ---------- ELEMENTS ---------- */
const intro = document.getElementById("intro");
const player = document.getElementById("player");
const iframe = document.getElementById("videoFrame");
const loading = document.getElementById("loading");
const btnMode = document.getElementById("btnMode");

/* ---------- START ---------- */
function startPlayer(){
  if(!rawUrl){
    intro.innerHTML = "<h2>No video link provided</h2>";
    return;
  }

  intro.classList.remove("active");
  player.classList.add("active");

  const embedUrl =
    "https://playterabox.com/embed/player?url=" +
    encodeURIComponent(rawUrl);

  iframe.src = embedUrl;

  iframe.onload = () => loading.style.display="none";
}

/* ---------- FULLSCREEN ---------- */
function toggleFS(){
  if(player.classList.contains("fullscreen")){
    player.classList.remove("fullscreen");
    player.classList.add("normal");
    btnMode.textContent = "⛶ Fullscreen";
    tg.exitFullscreen?.();
    tg.unlockOrientation?.();
  }else{
    player.classList.remove("normal");
    player.classList.add("fullscreen");
    btnMode.textContent = "⟳ Normal";
    tg.requestFullscreen?.();
    tg.lockOrientation?.();
  }
}

/* ---------- CLOSE ---------- */
function closeApp(){
  tg.close();
}
</script>

</body>
</html>
